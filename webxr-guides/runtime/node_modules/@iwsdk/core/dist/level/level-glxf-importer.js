import { GLXFLoader } from '@iwsdk/glxf';
import { AssetManager } from '../asset/asset-manager.js';
import '../asset/cache-manager.js';
import { EntityCreator } from './level-entity-creator.js';

/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * Loads a GLXF composition, attaches the scene graph, and creates ECS entities/components
 * based on `meta_spatial.components` extras.
 *
 * @remarks
 * - Uses the {@link AssetManager} GLTF loader so previously cached assets are reused.
 * - Each topâ€‘level child of the GLXF active scene is attached to the current level root.
 * - Component names are resolved against the registry as `com.iwsdk.components.<id>`.
 *
 * @category Scene
 */
class GLXFImporter {
    static async load(world, url, parentEntity) {
        var _a, _b;
        const loader = new GLXFLoader(AssetManager.loadingManager).setGLTFLoader({
            loadAsync: (u) => AssetManager.loadGLTF(u),
        });
        const glxf = await loader.loadAsync(url);
        const levelRoot = (_a = parentEntity.object3D) !== null && _a !== void 0 ? _a : world.getActiveRoot();
        const levelParentEntity = (_b = parentEntity !== null && parentEntity !== void 0 ? parentEntity : world.activeLevel.value) !== null && _b !== void 0 ? _b : world.sceneEntity;
        [...glxf.scene.children].forEach((child) => {
            levelRoot.attach(child);
            EntityCreator.createEntitiesFromObject3D(child, glxf.nodes, levelParentEntity, world);
        });
    }
}

export { GLXFImporter };
//# sourceMappingURL=level-glxf-importer.js.map
